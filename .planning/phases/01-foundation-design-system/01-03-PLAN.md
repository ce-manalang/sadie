---
phase: 01-foundation-design-system
plan: 03
type: execute
wave: 2
depends_on:
  - 01-01
  - 01-02
files_modified:
  - src/App.jsx
  - src/components/Dashboard.jsx
  - src/components/PublicCatalog.jsx
  - src/components/BookDetail.jsx
  - src/components/Login.jsx
  - src/main.jsx
autonomous: false
requirements:
  - FOUND-04
  - DSGN-03
  - DSGN-04

must_haves:
  truths:
    - "No <el-*> custom elements remain in any component file"
    - "App background is near-white (#f8f9fa) with calm color palette throughout"
    - "Page headings render in Syne Mono (font-display class)"
    - "Book covers sit on floating white cards with subtle shadow that lifts on hover"
    - "Book cover morphs from grid position to detail position via shared element transition"
    - "Book grid reveals with staggered animation"
    - "Error boundary wraps routes and shows ErrorFallback on component errors"
    - "Page components use custom hooks instead of inline API calls"
    - "Login page is styled with calm design tokens (not bare form elements)"
  artifacts:
    - path: "src/App.jsx"
      provides: "App shell with ErrorBoundary, LayoutGroup, calm navigation, no <el-*> elements"
      contains: "ErrorBoundary"
    - path: "src/components/Dashboard.jsx"
      provides: "Library view using useLibraryBooks hook, design tokens, motion animations"
      contains: "useLibraryBooks"
    - path: "src/components/PublicCatalog.jsx"
      provides: "Catalog view with staggered grid reveal, motion cards with hover lift, layoutId on covers"
      contains: "layoutId"
    - path: "src/components/BookDetail.jsx"
      provides: "Detail view using useBookDetail hook, shared element cover, no <el-*> elements"
      contains: "useBookDetail"
    - path: "src/components/Login.jsx"
      provides: "Login form using useAuth hook, styled with design tokens"
      contains: "useAuth"
  key_links:
    - from: "src/App.jsx"
      to: "src/components/ErrorFallback.jsx"
      via: "ErrorBoundary FallbackComponent={ErrorFallback}"
      pattern: "FallbackComponent.*ErrorFallback"
    - from: "src/components/Dashboard.jsx"
      to: "src/hooks/useLibraryBooks.js"
      via: "const { books, loading, error, removeBook } = useLibraryBooks()"
      pattern: "useLibraryBooks"
    - from: "src/components/BookDetail.jsx"
      to: "src/hooks/useBookDetail.js"
      via: "const { book, loading, error, addToLibrary, adding } = useBookDetail(id)"
      pattern: "useBookDetail"
    - from: "src/components/Login.jsx"
      to: "src/hooks/useAuth.js"
      via: "const { login } = useAuth()"
      pattern: "useAuth"
    - from: "src/components/PublicCatalog.jsx"
      to: "src/components/BookDetail.jsx"
      via: "layoutId={`book-cover-${book.id}`} matching between grid and detail views"
      pattern: "layoutId.*book-cover"
    - from: "src/App.jsx"
      to: "framer-motion LayoutGroup"
      via: "LayoutGroup wraps Routes to enable shared element transitions across route changes"
      pattern: "LayoutGroup"
---

<objective>
Wire hooks and design tokens into all pages. Replace custom elements. Add animations.

Purpose: This is where Sadie transforms visually. Plans 01 and 02 created the building blocks (tokens, hooks, ErrorFallback). This plan wires everything together: components switch from inline API calls to custom hooks, hardcoded colors become design token utilities, non-functional `<el-*>` elements become proper React components, and framer-motion brings the calm, intentional motion the user wants.

Output: All page components restyled with design tokens, using custom hooks, with framer-motion animations, wrapped in ErrorBoundary. No `<el-*>` elements remain.
</objective>

<execution_context>
@/Users/august/.claude/get-shit-done/workflows/execute-plan.md
@/Users/august/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-design-system/01-CONTEXT.md
@.planning/phases/01-foundation-design-system/01-RESEARCH.md
@.planning/phases/01-foundation-design-system/01-01-SUMMARY.md
@.planning/phases/01-foundation-design-system/01-02-SUMMARY.md
@src/App.jsx
@src/components/Dashboard.jsx
@src/components/PublicCatalog.jsx
@src/components/BookDetail.jsx
@src/components/Login.jsx
@src/hooks/useLibraryBooks.js
@src/hooks/useBookDetail.js
@src/hooks/useAuth.js
@src/components/ErrorFallback.jsx
@src/api/samClient.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restyle App shell, wire ErrorBoundary, replace custom elements</name>
  <files>src/App.jsx, src/main.jsx</files>
  <action>
    Rewrite src/App.jsx to:

    **1. Remove ALL `<el-*>` custom elements** (el-dialog, el-dialog-backdrop, el-dialog-panel, el-tab-group, etc.) and ALL `command`/`commandfor` attributes. Replace the mobile menu with a React state-driven implementation:
    - `const [mobileMenuOpen, setMobileMenuOpen] = useState(false)`
    - Button toggles `setMobileMenuOpen(!mobileMenuOpen)`
    - Mobile menu renders conditionally: `{mobileMenuOpen && (<div className="fixed inset-0 z-50 lg:hidden">...</div>)}`
    - Wrap mobile menu in `<AnimatePresence>` with `<motion.div>` for slide-in animation (translateX from -100% to 0, 300ms ease-out)
    - Backdrop: `<motion.div>` with opacity fade (0 to 0.25)
    - Close button uses `onClick={() => setMobileMenuOpen(false)}`

    **2. Wire authentication:**
    - Replace the inline `useState(localStorage.getItem('token'))` + `setToken` pattern with `useAuth` hook:
      ```js
      const { token, logout, isAuthenticated } = useAuth();
      ```
    - Remove the `setToken` prop passing. Login component will use its own `useAuth` hook instance.
    - Since useAuth manages localStorage internally, both App and Login share the same source of truth.
    - IMPORTANT: Because useAuth uses useState internally and different component instances won't share state, keep App's own token state but have Login call a callback to update it. The simplest approach: keep `const [token, setToken] = useState(localStorage.getItem('token'))` in App, pass `setToken` to Login, but use the `useAuth` hook's `logout` function. This preserves the existing auth flow while extracting logout logic.

    **3. Apply design tokens to navigation:**
    - Background: `bg-background` (not bg-white)
    - Nav bar: `bg-surface/90 backdrop-blur-xl` (floating glass effect on near-white)
    - Logo: Replace Tailwind logo image with text "Sadie" in `font-display text-xl text-gray-800` (Syne Mono). Remove the external image URL.
    - Nav links: `text-sm font-display text-gray-600 hover:text-teal-600 transition-colors duration-200`
    - Auth links: Same styling as nav links
    - Remove the non-functional search icon from the header (search is deferred to Phase 2)

    **4. Wrap routes in ErrorBoundary and LayoutGroup:**
    ```jsx
    import { ErrorBoundary } from 'react-error-boundary';
    import { ErrorFallback } from './components/ErrorFallback';
    import { LayoutGroup } from 'framer-motion';

    // Inside AppContent, around Routes:
    <ErrorBoundary FallbackComponent={ErrorFallback} onReset={() => window.location.reload()}>
      <LayoutGroup>
        <Routes>
          ...
        </Routes>
      </LayoutGroup>
    </ErrorBoundary>
    ```
    LayoutGroup enables shared element transitions (layoutId) across route changes.

    **5. Restyle footer:**
    - `bg-background` instead of bg-white
    - Border: `border-gray-200`
    - Text: `text-sm text-gray-500`
    - Update copyright text: "Sadie" instead of "Your Library, Inc."

    **6. Main content area:**
    - Remove the wrapping `bg-white` div. Use `bg-background min-h-screen` on the outermost div.
    - Keep `mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8` on the main content wrapper.

    For src/main.jsx: No changes needed (it imports App and index.css which is already correct).
  </action>
  <verify>
    Run `npm run build` -- no errors.
    Grep src/App.jsx for "el-" -- should return 0 matches.
    Grep src/App.jsx for "command=" -- should return 0 matches.
    Grep src/App.jsx for "ErrorBoundary" -- should match.
    Grep src/App.jsx for "LayoutGroup" -- should match.
    Grep src/App.jsx for "tailwindcss.com" or "tailwindplus" -- should return 0 (no external assets).
  </verify>
  <done>App.jsx has no `<el-*>` elements. Mobile menu uses React state + framer-motion. ErrorBoundary wraps routes with ErrorFallback. LayoutGroup enables shared element transitions. Navigation uses design tokens (Syne Mono logo, teal hover, calm colors). Footer branded as "Sadie".</done>
</task>

<task type="auto">
  <name>Task 2: Restyle page components, wire hooks, add animations</name>
  <files>src/components/PublicCatalog.jsx, src/components/Dashboard.jsx, src/components/BookDetail.jsx, src/components/Login.jsx</files>
  <action>
    **PublicCatalog.jsx -- Staggered grid with hover lift and shared element covers:**

    1. Replace inline axios fetch with samClient import:
       ```js
       import sam from '../api/samClient';
       ```
       Replace `axios.get(API_URL)` with `sam.get('/books')`. Remove the hardcoded API_URL constant and the axios import.

    2. Add framer-motion imports: `import { motion } from 'framer-motion'`

    3. Define animation variants at module level:
       ```js
       const containerVariants = {
         hidden: { opacity: 0 },
         visible: {
           opacity: 1,
           transition: { staggerChildren: 0.05, delayChildren: 0.1 }
         }
       };
       const itemVariants = {
         hidden: { opacity: 0, y: 20 },
         visible: {
           opacity: 1, y: 0,
           transition: { duration: 0.3, ease: 'easeOut' }
         }
       };
       ```

    4. Restyle the page:
       - Remove `bg-white` wrapper div. The bg-background is on the App shell.
       - Page heading: `font-display text-2xl text-gray-800` (Syne Mono)
       - Subtitle: `text-sm text-gray-500`
       - Grid: Wrap in `<motion.div variants={containerVariants} initial="hidden" animate="visible">` with `grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6`
       - Each card: `<motion.div variants={itemVariants} whileHover={{ y: -4, transition: { duration: 0.2, ease: 'easeOut' } }}>` with `bg-surface rounded-card shadow-card hover:shadow-card-hover transition-shadow duration-200 overflow-hidden`
       - Book cover: `<motion.img layoutId={`book-cover-${book.id}`}>` with `w-full aspect-[2/3] object-cover rounded-t-card` (rounded top corners only since it's inside the card)
       - Card content area: `p-4` with title in `font-display text-base text-gray-800` and author in `text-sm text-gray-500`
       - Remove ISBN display from catalog cards (too much detail for grid view)
       - Remove description from catalog cards (clean, minimal cards)

    **Dashboard.jsx -- Library view with hooks and design tokens:**

    1. Replace ALL inline axios/fetch logic with useLibraryBooks hook:
       ```js
       import { useLibraryBooks } from '../hooks/useLibraryBooks';
       const { books, loading, error, removeBook } = useLibraryBooks();
       ```
       Remove useState for myBooks/loading, remove useEffect, remove handleRemoveBook function. The hook handles all of it.

    2. Add framer-motion: Same containerVariants/itemVariants as PublicCatalog for staggered reveal. Each card gets `whileHover` lift.

    3. Restyle:
       - Remove `bg-white` wrapper
       - Heading: `font-display text-2xl text-gray-800`
       - Subtitle: `text-sm text-gray-500`
       - Grid: Same staggered motion grid as PublicCatalog
       - Cards: `bg-surface rounded-card shadow-card` with hover lift
       - Book covers: `<motion.img layoutId={`book-cover-${book.dato_book_id}`}>` for shared element transitions
       - Status badge: Replace `text-indigo-600` with `text-teal-600 font-display text-xs`
       - Tags: `bg-gray-100 text-gray-600 rounded-sm px-2 py-0.5 text-xs`
       - Remove button: Replace red bg with subtle style: `text-sm text-gray-400 hover:text-error transition-colors duration-200` -- less aggressive, fits calm aesthetic. Use text "Remove" instead of "Remove from Library" for brevity.
       - Empty state: Warm message using design tokens: `font-display text-xl text-gray-600` for heading, `text-gray-500 leading-relaxed` for body. Add a Link to "/" catalog with teal text.
       - Loading state: Use design token colors (`text-gray-500`)
       - Error state: If hook returns error, display it with `text-error` and a retry link

    4. Remove `window.confirm` -- call `removeBook(book.id)` directly from the hook. (Gentle confirmation dialog is a Phase 2 requirement UX-01, not Phase 1.)

    **BookDetail.jsx -- Shared element + hooks + replace custom elements:**

    1. Replace ALL inline axios/fetch logic with useBookDetail hook:
       ```js
       import { useBookDetail } from '../hooks/useBookDetail';
       const { book, loading, error, addToLibrary, adding } = useBookDetail(id);
       ```
       Remove useState for book/loading/error/adding, remove useEffect, remove addToLibrary function.

    2. **Remove ALL `<el-*>` elements:**
       - Remove `<el-tab-group>`, `<el-tab-list>`, `<el-tab-panels>` -- replace with a simple cover image (the tab gallery was for multiple images but only shows one). Just render the cover image directly.
       - Remove `<el-disclosure>` for tags -- replace with a React `useState` toggle:
         ```jsx
         const [tagsOpen, setTagsOpen] = useState(false);
         ```
         Button toggles `setTagsOpen(!tagsOpen)`. Content wrapped in `<AnimatePresence>` + `<motion.div initial={{ height: 0, opacity: 0 }} animate={{ height: 'auto', opacity: 1 }} exit={{ height: 0, opacity: 0 }} transition={{ duration: 0.2 }}>`.
       - Remove `command` and `commandfor` attributes.

    3. Add framer-motion shared element on cover:
       ```jsx
       <motion.img
         layoutId={`book-cover-${id}`}
         src={book.cover?.url || '/placeholder-cover.svg'}
         alt={`${book.title} cover`}
         className="w-full max-w-md rounded-image shadow-lg"
       />
       ```

    4. Restyle:
       - Remove `bg-white` wrapper
       - Title: `font-display text-3xl text-gray-800` (not font-bold, Syne Mono has its own weight)
       - Author: `text-xl text-teal-600` (replace indigo)
       - "In Library" badge: `bg-teal-400/10 text-teal-700 border border-teal-400/20 rounded-sm px-3 py-0.5 text-sm font-display`
       - Description: `text-base leading-relaxed text-gray-600`
       - "Add to Library" button: `bg-teal-500 hover:bg-teal-600 text-white px-8 py-3 rounded-card transition-colors duration-200` (replace indigo). Wrap in `<motion.button whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }}>` for tactile feel.
       - Personal status/notes section: `bg-gray-50 rounded-card p-4 border border-gray-200`
       - Tags disclosure button: `text-sm font-display text-gray-800` with teal active state
       - Remove the heart/favorites button (out of scope)
       - Fix `class="mt-12"` to `className="mt-12"` on the section element (existing bug)
       - Error state: Use design tokens, show "Go back" link in teal
       - Loading state: `text-gray-500` with subtle pulse

    **Login.jsx -- Styled form with useAuth hook (but keep setToken prop for App state sync):**

    1. The Login component currently receives `setToken` prop. Keep this prop for now since App.jsx manages top-level auth state. Wire the hook for the login call:
       ```js
       import { useAuth } from '../hooks/useAuth';
       const { login } = useAuth();
       ```
       In handleSubmit, call `const result = await login(email, password)`. If `result.success`, call `setToken(result.token)` (update useAuth to return the token in the success result) and navigate to dashboard. If not, show error message in UI (not window.alert).

    2. Restyle as a proper sign-in page:
       - Centered layout: `min-h-[60vh] flex items-center justify-center`
       - Card: `bg-surface rounded-card shadow-card p-8 w-full max-w-sm`
       - Heading: `font-display text-2xl text-gray-800 text-center mb-6` -- "Sign in"
       - Input fields: `w-full px-4 py-3 border border-gray-200 rounded-card text-base text-gray-800 placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-teal-400/50 focus:border-teal-400 transition-colors duration-200`
       - Labels: `text-sm font-display text-gray-600 mb-1 block`
       - Submit button: `w-full bg-teal-500 hover:bg-teal-600 text-white py-3 rounded-card font-display transition-colors duration-200`
       - Error message: `text-sm text-error text-center mt-4` (replace window.alert)
       - Remove `alert("Logged in to Sam!")` -- just navigate to dashboard on success
       - Spacing between fields: `space-y-4` on the form, with `mb-6` before the button
  </action>
  <verify>
    Run `npm run build` -- no errors.
    Grep ALL files in src/ for "el-" custom elements -- should return 0 matches for `<el-` patterns.
    Grep for "indigo" in JSX files -- should return 0 (all replaced with teal/gray).
    Grep for "localhost:3000" in JSX files -- should return 0 (all use samClient).
    Grep for "window.alert" or "window.confirm" in JSX files -- should return 0.
    Grep for "useLibraryBooks" in Dashboard.jsx -- should match.
    Grep for "useBookDetail" in BookDetail.jsx -- should match.
    Grep for "layoutId" in PublicCatalog.jsx and BookDetail.jsx -- should match in both.
    Grep for "ErrorBoundary" in App.jsx -- should match.
  </verify>
  <done>All page components restyled with design tokens. Custom hooks wired into Dashboard, BookDetail, and Login. All `<el-*>` custom elements replaced with React state + framer-motion. Shared element transitions on book covers (layoutId). Staggered grid reveal. Hover lift on cards. ErrorBoundary wraps routes. No hardcoded API URLs. No indigo colors. No window.alert/confirm.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Visual verification of complete redesign</name>
  <action>
    User verifies the complete visual redesign of Sadie by running the dev server and checking all pages.
  </action>
  <what-built>Complete visual redesign of Sadie: calm color palette (cool grays + muted teal), Syne Mono headings, floating cards with subtle shadows, staggered grid reveals, shared element book cover transitions, error boundary with "Your books are safe" fallback, custom hooks replacing inline API calls, and all non-functional custom elements replaced.</what-built>
  <how-to-verify>
    1. Start the dev server: `npm run dev`
    2. Open http://localhost:5173 in browser

    **Visual check:**
    - Background should be near-white (#f8f9fa), not pure white
    - "Sadie" logo in top-left should be in Syne Mono (distinctive geometric monospace)
    - Navigation links should have teal hover color

    **Public catalog (home page):**
    - Book grid should reveal with staggered animation (cards fade up one after another)
    - Cards should be white with subtle shadow, rounded corners
    - Hovering a card should lift it slightly (4px up) with shadow deepening
    - Headings in Syne Mono, body text in system font

    **Book detail (click a book):**
    - Book cover should morph/animate from its grid position to the detail page position (shared element transition)
    - Title in Syne Mono, author in muted teal
    - "Add to Library" button is teal (not indigo)
    - If tags exist, disclosure should toggle open/close with animation

    **Dashboard (/dashboard, requires login):**
    - Library books show with same card style and staggered animation
    - "Remove" button is subtle (not aggressive red)
    - If library empty, shows warm message with link to catalog

    **Login (/login):**
    - Centered card with styled inputs (teal focus rings)
    - No raw browser alerts on login

    **Error boundary (test by temporarily throwing in a component):**
    - Should show "Something went wrong" with book icon and "Try again" button
    - (Optional: add `throw new Error('test')` in PublicCatalog to verify, then remove)

    3. Test mobile responsive (resize browser to mobile width):
    - Hamburger menu should open/close with slide animation
    - Grid should stack to single column
  </how-to-verify>
  <verify>User confirms visual appearance matches the calm, minimal aesthetic described in the context.</verify>
  <done>User has verified the visual redesign looks correct across all pages and responsive breakpoints.</done>
  <resume-signal>Type "approved" or describe any visual/functional issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. Zero `<el-*>` custom elements in any JSX file
3. Zero `indigo` color references in any JSX file
4. Zero hardcoded `localhost:3000` URLs in any JSX file
5. Zero `window.alert` or `window.confirm` calls
6. All page components use custom hooks for API logic
7. ErrorBoundary wraps routes in App.jsx
8. Shared element layoutId on book covers in both PublicCatalog and BookDetail
9. Staggered animation variants on grid containers
10. User verifies visual appearance matches calm, minimal aesthetic
</verification>

<success_criteria>
- App visually transformed: calm palette, Syne Mono headings, system font body, floating cards, subtle shadows
- All `<el-*>` elements replaced with working React components
- Custom hooks (useLibraryBooks, useBookDetail, useAuth) wired into page components
- ErrorBoundary catches component errors with warm fallback UI
- framer-motion animations: staggered grid, hover lift, shared element covers
- No hardcoded API URLs, no window.alert/confirm, no indigo colors
- User confirms visual appearance
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-design-system/01-03-SUMMARY.md`
</output>
